module.exports = function(document, id, model) {
    var dir_window = {
        id : id,
        model : model,
        el : document.querySelector('#' + id),
        classes : {
            controlPanel : 'app-panel',
            goupbutton : 'app-btn',
            ul : 'app-list',
            li : 'app-item',
            msg : 'app-msg'
        },
        fragment : '',
        init : function() {
            var self = this;
            // create the view
            this.fragment = '<div class="' + this.classes.controlPanel + '">' +
                '<input type="text" name="name" id="filename" placeholder="file name" />' +
                '<button class="' + this.classes.goupbutton + '">Up</button>' +
                '<button onclick="app.fn.hidePanel(\'' + this.id + '\')">Back</button>' +
                '</div>' +
                '<div class="' + this.classes.controlPanel + '-base">&nbsp;</div>' +
                '<ul class="' + this.classes.ul + ' scroll">' +
                '</ul>' +
                '<div class="' + this.classes.msg + '"></div>';
            this.el.appendHTML(this.fragment);
            document.querySelector('.' + this.classes.goupbutton).onclick = function() {
                self.render('..');
            };
            //this.render();
        },
        render : function(dir) {
            d = dir === undefined ? '' : dir;
            var self = this;
            self.model.getPath(d, function(err, files) {
                if (err) {
                    // show error message
                    self.msg(err.message);
                } else {
                    var list = document.querySelector('.' + self.classes.ul);
                    list.innerHTML = '';
                    for (var i = 0, is = files.length; i < is; ++i) {
                        var item = document.createElement('li');
                        item.className = self.classes.li;
                        item.innerHTML = '<p class="item-title">' + files[i] + '</p>';
                        item.onclick = function() {
                            self.render(this.innerText);
                        }
                        list.appendChild(item);
                    }
                }
            });
        },
        msg : function(message) {
            var msg = document.querySelector('.' + this.classes.msg);
            msg.innerText = message;
            msg.style.opacity = 1;
            msg.style.visibility = 'visible';
            setTimeout(function() {
                msg.style.opacity = 0;
                msg.style.visibility = 'hidden';
            }, 3000);
        }
    };
    return dir_window;
}